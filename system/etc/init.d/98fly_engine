#!/system/bin/sh
# ===========================================
# ===========================================
# ========== Fly_core | Fly-On Mod™ =========
# ========== By Slaid480@XDA 2013 ===========
# ===========================================
# ===========================================


# VFS, VM,Kernel Tweaks

#sysctl -w kernel.sem="250 256000 32 1024";
#sysctl -w kernel.shmmax="$max";
#sysctl -w kernel.shmall="$all";
#sysctl -w kernel.msgmni=1024;

#echo $max > /proc/sys/kernel/shmmax;
#echo $all > /proc/sys/kernel/shmall;

if [ "$mem" -lt 524288 ];then
  sysctl -w vm.dirty_background_ratio=15;
  sysctl -w vm.dirty_ratio=30;
elif [ "$mem" -lt 1049776 ];then
  sysctl -w vm.dirty_background_ratio=10;
  sysctl -w vm.dirty_ratio=20;
else
  sysctl -w vm.dirty_background_ratio=5;
  sysctl -w vm.dirty_ratio=10;
fi;

sysctl -w vm.page-cluster=3;
sysctl -w vm.laptop_mode=0;
sysctl -w vm.dirty_expire_centisecs=3000;
sysctl -w vm.dirty_writeback_centisecs=500;
sysctl -w vm.vfs_cache_pressure=50;
sysctl -w vm.overcommit_memory=1;
sysctl -w vm.oom_kill_allocating_task=0;




# Tweaking processes at wake

#    renice -1 `pidof com.android.phone`;   
#    renice -1 `pidof com.android.mms`; # Text message app
#    renice -1 `pidof com.swype.android.inputmethod`; # Keyboard
#    renice -1 `pidof com.sec.android.app.controlpanel`; # Task manager
#    renice -1 `pidof com.android.systemui`; # Status bar
#    renice -1 `pidof com.android.settings`; # Settings menu
#    renice -1 `pidof com.android.vending`; # Market app
#    renice -1 `pidof com.sec.android.app.camera`; # Camera app
#    renice -1 `pidof android.process.acore`;
#    renice -1 `pidof kondemand/0`;
#    renice -1 `pidof ksmartass_up/0`;




# Network speed and throughput Tweaks

sysctl -w net.ipv4.tcp_timestamps=0;
sysctl -w net.ipv4.tcp_tw_reuse=1;
sysctl -w net.ipv4.tcp_sack=1;
sysctl -w net.ipv4.tcp_dsack=1;
sysctl -w net.ipv4.tcp_tw_recycle=1;
sysctl -w net.ipv4.tcp_window_scaling=1;
sysctl -w net.ipv4.tcp_keepalive_probes=5;
sysctl -w net.ipv4.tcp_keepalive_intvl=30;
sysctl -w net.ipv4.tcp_fin_timeout=30;
sysctl -w net.ipv4.tcp_moderate_rcvbuf=1;

#echo 524288 > /proc/sys/net/core/wmem_max;
#echo 524288 > /proc/sys/net/core/rmem_max;

# increase Linux auto tuning TCP buffer limits
#echo "524280" > /proc/sys/net/core/rmem_default # default:
#echo "524280" > /proc/sys/net/core/wmem_default # default:

# Increase the maximum total TCP buffer-space allocatable
#sysctl -w net.ipv4.tcp_mem="57344 57344 524288";

#echo 256960 > /proc/sys/net/core/rmem_default;
#echo 256960 > /proc/sys/net/core/wmem_default;
#echo 4096 16384 404480 > /proc/sys/net/ipv4/tcp_wmem;
#echo 4096 87380 404480 > /proc/sys/net/ipv4/tcp_rmem;

# Increase the tcp-time-wait buckets pool size
#sysctl -w net.ipv4.tcp_max_tw_buckets="1440000"
# default: 180000

# Increase the maximum amount of option memory buffers
#sysctl -w net.core.optmem_max="57344"
# default: 20480




# Build.prop Tweaks

# Smoother Scrolling
setprop windowsmgr.max_events_per_sec 240
# Battery saving Tweaks
setprop ro.ril.disable.power.collapse 0
setprop pm.sleep_mode 1
setprop wifi.supplicant_scan_interval 150
#Graphics Tweaks and improvments
setprop ro.media.enc.hprof.vid.bps 8000000
setprop persist.sys.use_dithering 1
setprop ro.media.dec.jpeg.memcap 8000000
setprop debug.performance.tuning 1
setprop video.accelerate.hw 1
#kernel tweaks(Disable error checking)
setprop ro.kernel.android.checkjni 0




# Disable Gentle Fair Sleepers(Would Improve smoothness)
echo "NO_GENTLE_FAIR_SLEEPERS" > /sys/kernel/debug/sched_features;
echo "NO_NEW_FAIR_SLEEPERS" > /sys/kernel/debug/sched_features;
echo "NO_NORMALIZED_SLEEPER" > /sys/kernel/debug/sched_features;



# End of fly_engine script
echo "fly_core Tweaks apllied succesfully,Enjoy!!!"








